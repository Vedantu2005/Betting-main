import React, { useEffect, useState } from 'react';
import { ArrowRight, Star, ShieldCheck, ExternalLink, FileText } from 'lucide-react';
import { collection, query, orderBy, limit, onSnapshot } from 'firebase/firestore';
import { db } from '../config/firebase';

const StarRating = ({ rating }) => {
  return (
    <div className="flex items-center justify-center bg-white px-3 py-1 rounded-full border border-slate-200 shadow-sm">
      {[...Array(5)].map((_, index) => (
        <Star
          key={index}
          size={14}
          className={`mx-[1px] ${index < rating ? 'text-yellow-400' : 'text-slate-200'}`}
          fill={index < rating ? 'currentColor' : 'none'}
          strokeWidth={index < rating ? 0 : 2}
        />
      ))}
    </div>
  );
};

const BestBettingSites = () => {
  const [sites, setSites] = useState([]);
  useEffect(() => {
    try {
      const q = query(collection(db, 'betting-sites'), orderBy('rating', 'desc'), limit(4));
      const unsubscribe = onSnapshot(q, (snapshot) => {
        const docs = snapshot.docs.map((s) => ({ id: s.id, ...s.data(), rating: Number(s.data().rating) || 0 }));
        setSites(docs);
      }, (err) => {
        console.error('Failed to fetch betting-sites for BestBettingSites', err);
      });
      return () => unsubscribe();
    } catch (err) {
      console.error('Error querying betting-sites', err);
    }
  }, []);

  return (
    <section className="bg-white py-10 md:py-10">
      <div className="max-w-7xl mx-auto px-6">
        <div className="text-center mb-16 max-w-3xl mx-auto">
          <h2 className="text-4xl md:text-5xl font-bold text-[#0a192f] mb-4">
            Best Cricket Betting Sites in 2025
          </h2>
          <p className="text-lg text-slate-600">
            There are many cricket betting sites in India. But you must choose the best one to stay safe.
          </p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          {sites.map((site) => (
            <div
              key={site.id}
              className="group relative bg-white rounded-2xl border border-[#0a192f] flex flex-col overflow-hidden hover:border-blue-400 transition-all duration-300 hover:shadow-xl hover:-translate-y-2"
            >

              {/* Header Section: Logo & Rating */}
              <div className="p-6 pb-4 flex flex-col items-center border-b border-[#0a192f] bg-gradient-to-b from-slate-50 to-white">
                <div className="h-12 mb-3 flex items-center justify-center">
                  <img
                    src={site.logoUrl || site.logo || '/default-logo.png'}
                    alt={`${site.bonusTitle} Logo`}
                    className="max-h-full w-auto object-contain drop-shadow-sm"
                  />
                </div>
                <StarRating rating={site.rating} />
              </div>

              {/* Body Section: Content */}
              <div className="p-5 flex-grow flex flex-col items-center text-center">
                {/* Pill Badge */}
                <div className="mb-3 inline-flex items-center px-3 py-1 rounded-full bg-blue-50 text-blue-600 text-[10px] font-bold uppercase tracking-wider border border-blue-100">
                  <ShieldCheck size={12} className="mr-1" /> Exclusive Welcome Bonus
                </div>

                <h3 className="text-[#0a192f] font-bold text-[1.05rem] leading-relaxed mb-5">
                  {site.bonusText}
                </h3>

                {/* Promo Code Box */}
                <div className="w-full mt-auto bg-slate-50 rounded-lg p-3 border border-dashed border-slate-300 flex flex-col sm:flex-row justify-between items-center gap-2 transition-colors group-hover:border-blue-300">
                  <span className="text-slate-500 text-xs font-medium uppercase">Promo Code</span>
                  <span className={`font-mono font-bold text-sm ${site.promoCode === 'NA' ? 'text-slate-400' : 'text-blue-600'}`}>
                    {site.promoCode}
                  </span>
                </div>
              </div>

              {/* Footer Section: Actions & Terms */}
              <div className="p-5 pt-0">
                <div className="grid grid-cols-2 gap-3">
                  <a href={'/review'} target="_blank" rel="noopener noreferrer" className="w-full">
                    <button className="flex items-center justify-center w-full px-4 py-3 bg-slate-100 text-slate-700 font-bold text-sm rounded-lg hover:bg-slate-200 hover:text-[#0a192f] transition-colors duration-200">
                      <FileText size={16} className="mr-2" /> REVIEW
                    </button>
                  </a>
                  <a href={site.url || '#'} target="_blank" rel="noopener noreferrer" className="w-full">
                    <button className="flex items-center justify-center w-full px-4 py-3 bg-[#2563EA] text-white font-bold text-sm rounded-lg transition-colors duration-200 shadow-md shadow-blue-200 hover:bg-[#1d4ed8]">
                      VISIT <ExternalLink size={16} className="ml-2" />
                    </button>
                  </a>
                </div>

                <div className="mt-4 text-center">
                  <p className="text-[10px] text-slate-400 leading-snug">
                    Advertising link. 18+. <a href="#" className="text-slate-500 underline hover:text-blue-600">Terms & Conditions</a> apply.
                  </p>
                </div>
              </div>

            </div>
          ))}
        </div>

        <div className="mt-20 text-center">
          <button
            className="inline-flex cursor-pointer items-center px-10 py-4 bg-[#2563EA] text-white font-bold text-lg rounded-full 
                       hover:bg-[#1d4ed8] transition-all duration-300 shadow-lg shadow-blue-200 transform hover:-translate-y-1"
          >
            SEE MORE SITES
            <ArrowRight size={22} className="ml-3" />
          </button>
        </div>

      </div>
    </section>
  );
};

export default BestBettingSites;